
{% put scripts %}
    {% if 'markercluster' in plugins %}
        <script>
            var markers = L.markerClusterGroup();
            {% for marker in __SELF__.markers %}
        	  	var marker = L.marker([{{ marker.lat }}, {{ marker.lon }}]);
                markers.addLayer(marker);
                //Put URL to post in popup
                var mansion_url ="/herrgardsdatabasen/gard/" + {{ marker.gard_id }};
                var popup_html = "<a href=\"" + mansion_url + "\" >{{ marker.name }}</a>";
                marker.bindPopup(popup_html);
            {% endfor %}
            {{ mapVar }}.addLayer(markers);
        </script>
    {% else %}
        <script>
            var leafletProIcon = L.icon({
                iconUrl: '{{ __SELF__.getMarkerIconUrl() | app }}',
                iconSize: [40, 40]
            });

            {% for marker in __SELF__.markers %}
                  L.marker([{{ marker.lat }}, {{ marker.lon }}], {icon: leafletProIcon})
                   .addTo({{ mapVar }})
                   .bindPopup('{{ marker.popup_content |replace({"\n": " ","\r": " ",  "\t": " "}) | raw }}');
            {% endfor %}
        </script>
    {% endif %}
{% endput %}
